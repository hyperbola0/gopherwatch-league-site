<!DOCTYPE html>
<html>
	<head>
		<title> Draft - The Gopherwatch League </title>
		<link rel="stylesheet" type="text/css" href="/css/style.css">
		<meta charset="UTF-8">
		<meta name="robots" content="noindex">
		<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
		<script src="/js/sortable-draft-table.js"></script>
		<script src="/js/link-team-names.js"></script>
		<script src="/js/utils.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
		<script src="/js/navbar.js"></script>
	</head>
	<body>
		<!-- navbar -->
		<nav class="navbar sticky-top navbar-expand-xl container-fluid navbar-light nav-bg fs-5 mb-5">
			<div class="container-fluid">
				<a class="navbar-brand"  href="/"><img src="/images/Aurora_Esports_Circle_Logo.png" alt="Gopherwatch League logo" width="72" height="72"></a>
				<button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navContents"><span class="navbar-toggler-icon"></span></button>
				<div class="navbar-collapse collapse" id="navContents">
					<ul class="navbar-nav me-auto mb-2 mb-xl-0">
						<li class="nav-item active pe-1"><a class="nav-link" id="nav-home-link" aria-current="page" href="#">Home</a></li>
						<li class="nav-item dropdown pe-1">
							<a class="dropdown-toggle nav-link" href="#" id="navbarTeamsDropdown" data-bs-toggle="dropdown" aria-expanded="false">Teams</a>
							<ul class="dropdown-menu" id="nav-team-dropdown-contents" aria-labeledby="navbarTeamsDropdown">
							</ul>
						</li>
						<li class="nav-item dropdown pe-1" id="nav-tourn-dropdown-li">
							<a class="dropdown-toggle nav-link" href="#" id="navbarTournamentsDropdown" data-bs-toggle="dropdown" aria-expanded="false">Tournaments</a>
							<ul class="dropdown-menu" id="nav-tourn-dropdown-contents" aria-labeledby="navbarTournamentsDropdown"></ul>
						</li>
						<li class="nav-item pe-1"><a class="nav-link" id="nav-schedule-link" href="#">Schedule</a></li>
						<li class="nav-item pe-1"><a class="nav-link" id="nav-standings-link" href="#">Standings</a></li>
						<li class="nav-item pe-1"><a class="nav-link" id="nav-stats-link" href="#">Stats</a></li>
						<li class="nav-item pe-1"><a class="nav-link" id="nav-draft-link" href="#">Draft</a></li>
						<li class="nav-item pe-1"><a class="nav-link" id="nav-signup-link" href="https://forms.gle/UTDneFFVvqLNq5Bt9" target="_blank">Season 2 Signup</a></li>
					</ul>
					<ul class="navbar-nav mb-2 mb-xl-0 me-3">
						<li class="nav-item dropdown pe-4">
							<a class="dropdown-toggle nav-link" href="#" id="navbarSeasonsDropdown" data-bs-toggle="dropdown" aria-expanded="false">Seasons</a>
							<ul class="dropdown-menu" id="nav-season-dropdown-contents" aria-labeledby="navbarSeasonsDropdown">
							</ul>
						</li>
						<li class="nav-item"><a href="/Discord/" target="_blank"><img src="/images/Discord-Logo.png" alt="Discord server invite link" width="182.5" height="50"></a></li>
					</ul>
				</div>
			</div>
		</nav>
		
		<h1 class="center" style="color:white; padding-top: 30px; padding-bottom: 30px;">Draft</h1>
		<div class="center">
			<table class="mytable center" id="draftTable">
				<thead>
					<tr>
						<th style="width:30%;" scope="col" onclick="sortTable('draftTable', 0)">Battletag</th>
						<th style="width:5%;" scope="col" onclick="sortTable('draftTable', 1)">Draft number</th>
						<th style="width:35%;" scope="col" onclick="sortTable('draftTable', 2)">Team</th>
						<th style="width:10%;" scope="col" onclick="sortTable('draftTable', 3)">Tank SR</th>
						<th style="width:10%;" scope="col" onclick="sortTable('draftTable', 4)">DPS SR</th>
						<th style="width:10%;" scope="col" onclick="sortTable('draftTable', 5)">Support SR</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
		</div>
		<script type="text/javascript">
		var season = window.location.pathname.split('/')[1];
		ajaxReq('/api/'+season+'/GetAllPlayersJson')
		.then(res => loadTable(res))
		.catch(err => {
			console.error("Ajax req failed for /api/season/GetAllPlayersJson!");
			console.info(err);
			return;
		});
		
		// loads table into HTML
		function loadTable(obj) {
			let jsonObj = JSON.parse(obj.responseText);
			if(jsonObj.error) {
				console.error("Server returned an error retrieving player json!");
				return;
			};
			// fill table
			var out = "";
			var table = jsonObj.players;
			for(i = 0; i < table.length; i++) {
				out += '<tr><td><p>';
				out += table[i].battletag;
				out += '</p></td><td><p>';
				if(table[i].draft === '0') {
					out += 'C';
				} else if(table[i].draft === '') {
					out += '-';
				} else {
					out += table[i].draft;
				}
				out += '</p></td><td class="team-name"><p>';
				if(table[i].team === '') {
					out += 'Undrafted';
				} else {
					out += table[i].team;
				}
				out += '</p></td><td><p>';
				if(table[i].tank == 'undefined' || table[i].tank == '') {
					out += '-';
				} else {
					out += table[i].tank;
				}
				out += '</p></td><td><p>';
				if(table[i].dps == 'undefined' || table[i].dps == '') {
					out += '-';
				} else {
					out += table[i].dps;
				}
				out += '</p></td><td><p>';
				if(table[i].support == 'undefined' || table[i].support == '') {
					out += '-';
				} else {
					out += table[i].support;
				}
				out += '</p></td></tr>';
			}
		
			document.getElementById("draftTable").getElementsByTagName("tbody")[0].innerHTML = out;
			sortTable('draftTable', 1); // default sorting is by draft order
			addLinks();
		}
		</script>
	</body>
</html>