<!-- navbar -->
<div class="navbar">
  <a class="nav-left" href="/"><img src="/images/leaguelogo_header.png" class="navbar-logo"></a>
  <a class="nav-left" id="navlink-home">Home</a>
  <div class="dropdown">
    <button class="dropbtn" id="navlink-teamsbtn" onclick="location.href='#';">Teams 
      <i class="fa fa-caret-down"></i>
    </button>
    <div id="navlink-teams-dropdown" class="dropdown-content">
    </div>
  </div> 
  <a class="nav-left" id="navlink-schedule" href="#">Schedule</a>
  <a class="nav-left" id="navlink-standings" href="#">Standings</a>
  <a class="nav-left" id="navlink-stats" href="#">Stats</a>
  <a href="#" id="navlink-draft" class="nav-left">Draft</a>
  <a href="/BugReport/" class="bugreport" target="_blank">Bug Reporter</a>
  <a href="/Discord/" class="discord" target="_blank">Join the Discord</a>
  <div class="dropdown">
	<button class="dropbtn" id="navlink-seasonsbtn" onlick="">Seasons
	  <i class="fa fa-caret-down"></i>
	</button>
	<div id="navlink-seasons-dropdown" class="dropdown-content">
	</div>
  </div>
  
  <!-- script that loads navbar links -->
  <script type="text/javascript">
	const ajaxReq = url => new Promise((resolve,reject) => {
		console.info(url);
		var xhttp = new XMLHttpRequest();
		xhttp.open("GET",url,true);
		xhttp.send();
	
		xhttp.onreadystatechange = function() {
			console.log(this.responseText);
			if(this.readyState == 4 && this.status == 200){
				resolve(this);
			} else {
				if(xhttp.status != 200)
					reject(this);
			}
		}
	});

	function loadNavbarLinks() {
		// get season name from address bar
		let sname = window.location.pathname.split('/')[1];
		console.log(`linking navbar! sname=${sname}`);

		// load static buttons with season links
		$("#navlink-home").attr("href",`/${sname}/Home`);
		$("#navlink-schedule").attr("href",`/${sname}/Schedule`);
		$("#navlink-standings").attr("href",`/${sname}/Standings`);
		$("#navlink-stats").attr("href",`/${sname}/Stats`);
		$("#navlink-draft").attr("href",`/${sname}/Draft`);
		
		// make ajax request for list of teams
		ajaxReq(`/api/${sname}/teams`)
		.then(res => {
			if(res.error) {
				console.log(res.error);
				alert(`Error: /api/${sname}/teams returned error: ${err}\n\nPlease send this to hyperbola0#4962 on the discord to make sure they are aware.`);
				return;
			}
			let arr = JSON.parse(res.responseText);
			console.log("=== NAVBAR AJAX RETURNED ===");
			for(i=0;i<arr.length;++i) {
				let added = "<a href=\"/" + sname + "/Teams/" + arr[i].internal + "\">" + arr[i].name + "</a>";
				console.log(added);
				$('#navlink-teams-dropdown').append(added);
			}
			
			console.log("navbar linked!");
		})
		.then(() => ajaxReq('/api/seasons'))
		.then(res => {
			if(res.error) {
				console.log(res.error);
				return;
			}
			let arr = JSON.parse(res.responseText);
			console.log(arr);
			for(i=0;i<arr.length;++i) {
				let added = "<a href=\"/" + arr[i].internal + "/Home\">" + arr[i].name + "</a>";
				$('#navlink-seasons-dropdown').append(added);
			}
		})
		.catch(err => console.log(error));
	}
	$(document).ready(loadNavbarLinks());
  </script>
</div>